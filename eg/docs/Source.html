<html><head><title>Noembed::Source</title>
<meta http-equiv="Content-Type" content="text/html; charset=ISO-8859-1" >
</head>
<body class='pod'>
<!--
  generated by Pod::Simple::HTML v3.19,
  using Pod::Simple::PullParser v3.19,
  under Perl v5.014002 at Thu Feb 23 04:47:38 2012 GMT.

 If you want to change this HTML document, you probably shouldn't do that
   by changing it directly.  Instead, see about changing the calling options
   to Pod::Simple::HTML, and/or subclassing Pod::Simple::HTML,
   then reconverting this document from the Pod source.
   When in doubt, email the author of Pod::Simple::HTML for advice.
   See 'perldoc Pod::Simple::HTML' for more info.

-->

<!-- start doc -->
<a name='___top' class='dummyTopAnchor' ></a>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="NAME"
>NAME</a></h1>

<p>Noembed::Source - a base class for embeddable Noembed sources</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="DESCRIPTION"
>DESCRIPTION</a></h1>

<p>This is a base class that is meant to be extended to create Noembed sources.
There are a few methods that need to be overridden for it to be usable.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="METHODS"
>METHODS</a></h1>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="REQUIRED"
>REQUIRED</a></h2>

<dl>
<dt><a name="patterns"
>patterns</a></dt>

<dd>
<p>Must return a list of strings that can be compiled into valid regular expressions.
e.g.
<code>&#34;http://www\.google\.com/.+&#34;</code></p>

<dt><a name="provider_name"
>provider_name</a></dt>

<dd>
<p>Must return the name of the provider.
e.g.
<code>Google</code></p>

<dt><a name="serialize_($body,_$req)"
>serialize ($body,
$req)</a></dt>

<dd>
<p>Receives the downloaded content and embed request.
This must return a hash reference containing <code>html</code> and <code>title</code> keys.
Additional key/value pairs will be included in the JSON response to the client.</p>
</dd>
</dl>

<h2><a class='u' href='#___top' title='click to go to top of document'
name="OPTIONAL"
>OPTIONAL</a></h2>

<dl>
<dt><a name="prepare_source"
>prepare_source</a></dt>

<dd>
<p>A convenience method called when noembed starts.
Use it to set up your source (e.g.
build a <code>Web::Scraper</code> attribute.)</p>

<dt><a name="shorturls"
>shorturls</a></dt>

<dd>
<p>Like <code>patterns</code>,
this must return a list of strings that can be compiled into valid regular expressions.
If a URL matches one of these patterns Noembed will resolve it and handle new URL.</p>

<dt><a name="options"
>options</a></dt>

<dd>
<p>Can return a list of parameter names that will be included with the final content URL request.
One useful example of this is in <code>autoplay</code> option for <a href="http://search.cpan.org/perldoc?YouTube" class="podlinkpod"
>Noembed::Source::YouTube</a>.</p>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HOOKS"
>HOOKS</a></h1>

<dl>
<dt><a name="pre_download_($req,_$callback)"
>pre_download ($req,
$callback)</a></dt>

<dd>
<p>Use this hook to run asynchronous code before the content URL is downloaded.
This can be useful if you need to make additional HTTP requests to determine the final content url.
Note: you <b>must</b> call the callback,
or the client request will hang indefinitely.</p>

<p>In this example from <a href="http://search.cpan.org/perldoc?Noembed%3A%3ASource%3A%3AFacebook" class="podlinkpod"
>Noembed::Source::Facebook</a> source the user&#39;s ID is required to build the final URL.
<code>Noembed::Util::http_get</code> is used to fetch the user&#39;s profile info.</p>

<pre>  sub pre_download {
    my ($self, $req, $cb) = @_;
    my $profile = &#34;https://graph.facebook.com/&#34;.$req-&#62;captures-&#62;[0];

    Noembed::Util::http_get $profile, sub {
      my ($body, $headers) = @_;
      my $data = decode_json $body;
      $req-&#62;content_url(&#34;https://graph.facebook.com/$data-&#62;{id}_&#34;.$req-&#62;captures-&#62;[1]);
      $cb-&#62;($req);
    };
  }</pre>

<dt><a name="post_download_($body,_$req,_$callback)"
>post_download ($body, $req, $callback)</a></dt>

<dd>
<p>Use this hook to run asynchronous code after the content is downloaded, but before the serialize method is called.</p>

<p>This example from <a href="http://search.cpan.org/perldoc?Noembed%3A%3ASource%3A%3AGist" class="podlinkpod"
>Noembed::Source::Gist</a> uses <code>Noembed::Util::colorize</code> to asynchronously syntax highlight the returned files. The provided callback is run only after all the files have been highlighted.</p>

<pre>  sub post_download {
    my ($self, $body, $req, $cb) = @_;
    my $gist = from_json $body;
    my $cv = AE::cv;

    for my $file (values %{$gist-&#62;{files}}) {
      $cv-&#62;begin;

      Noembed::Util::colorize $file-&#62;{content},
        language =&#62; lc $file-&#62;{language},
        filename =&#62; lc $file-&#62;{filename},
        sub {
          my $colorized = shift;
          $file-&#62;{content} = html($colorized);
          $cv-&#62;end;
        };
    }

    $cv-&#62;cb(sub {$cb-&#62;($gist)});
  }</pre>
</dd>
</dl>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="HTML_TEMPLATES_AND_STYLESHEETS"
>HTML TEMPLATES AND STYLESHEETS</a></h1>

<p>This class also provides a render method. This method will search for a template in <code>./share/templates/</code> that matches the name of the class (e.g. <code>Google.pm</code> -&#62; <code>Google.html</code>). The render method will pass arguments onto the template. See <a href="http://search.cpan.org/perldoc?Text%3A%3AMicroTemplate" class="podlinkpod"
>Text::MicroTemplate</a> for template basics.</p>

<p>If you create a similarly named stylesheet (<code>Google.pm</code> -&#62; <code>Google.css</code>) in <code>./share/styles/</code>, it will automatically be included in the <code>/noembed.css</code> file.</p>

<h1><a class='u' href='#___top' title='click to go to top of document'
name="SEE_ALSO"
>SEE ALSO</a></h1>

<p><a href="http://search.cpan.org/perldoc?Noembed%3A%3ASource%3A%3AGist" class="podlinkpod"
>Noembed::Source::Gist</a>, <a href="http://search.cpan.org/perldoc?Noembed%3A%3ASource%3A%3AFacebook" class="podlinkpod"
>Noembed::Source::Facebook</a>, <a href="http://search.cpan.org/perldoc?Noembed%3A%3ASource%3A%3AWikipedia" class="podlinkpod"
>Noembed::Source::Wikipedia</a></p>

<!-- end doc -->

</body></html>
